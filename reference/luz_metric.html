<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Creates a new luz metric"><title>Creates a new luz metric — luz_metric • luz</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="../deps/bs3compat-0.3.1/transition.js"></script><script src="../deps/bs3compat-0.3.1/tabs.js"></script><script src="../deps/bs3compat-0.3.1/bs3compat.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><link href="../syntax-highlighting.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Creates a new luz metric — luz_metric"><meta property="og:description" content="Creates a new luz metric"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc" data-headroom>
    

      <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a class="navbar-brand mb-0 h1" href="../index.html">luz</a>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <button type="button" id="version-badge" class="badge badge-default d-none d-lg-block" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="">0.2.0</button>

    <div id="navbar" class="collapse navbar-collapse">
      <ul class="navbar-nav mr-auto ml-3"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/get-started.html">Get started</a>
    <a class="dropdown-item" href="../articles/custom-loop.html">Custom loops</a>
    <a class="dropdown-item" href="../articles/accelerator.html">Accelerator API</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/examples/index.html">Examples</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control mr-sm-2" aria-label="Search" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search..." autocomplete="off"></form>

      <ul class="navbar-nav ml-1"><li class="nav-item">
  <a class="nav-link" href="https://github.com/mlverse/luz/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <div class="col-md-9 contents">
    <img src="" class="pkg-logo" alt=""><div class="page-header pb-2 mt-4 mb-2 border-bottom toc-ignore">
    <h1 class="display-4">Creates a new luz metric</h1>
    <small class="dont-index">Source: <a href="https://github.com/mlverse/luz/blob/master/R/metrics.R"><code>R/metrics.R</code></a></small>
    <div class="d-none name"><code>luz_metric.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Creates a new luz metric</p>
    </div>

    <div id="ref-usage" class="ref-usage section level2 sourceCode">
    <pre class="sourceCode r"><code><span class="fu">luz_metric</span><span class="op">(</span>
  name <span class="op">=</span> <span class="cn">NULL</span>,
  <span class="va">...</span>,
  private <span class="op">=</span> <span class="cn">NULL</span>,
  active <span class="op">=</span> <span class="cn">NULL</span>,
  parent_env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span><span class="op">(</span><span class="op">)</span>,
  inherit <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre>
    </div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments" aria-hidden="true"></a>Arguments</h2>
    <dl class="row" id="ref-arguments"><dt class="col-sm-3 section level2" id="pkg-arg-name">name</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>string naming the new metric.</p></dd>
    <dt class="col-sm-3 section level2" id="pkg-arg-...">...</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>named list of public methods. You should implement at least
<code>initialize</code>, <code>update</code> and <code>compute</code>. See the details section for more
information.</p></dd>
    <dt class="col-sm-3 section level2" id="pkg-arg-private">private</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>An optional list of private members, which can be functions
and non-functions.</p></dd>
    <dt class="col-sm-3 section level2" id="pkg-arg-active">active</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>An optional list of active binding functions.</p></dd>
    <dt class="col-sm-3 section level2" id="pkg-arg-parent_env">parent_env</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>An environment to use as the parent of newly-created
objects.</p></dd>
    <dt class="col-sm-3 section level2" id="pkg-arg-inherit">inherit</dt>
      <dd class="col-sm-9" id="ref-arguments desc"><p>A R6ClassGenerator object to inherit from; in other words, a
superclass. This is captured as an unevaluated expression which is
evaluated in <code>parent_env</code> each time an object is instantiated.</p></dd>
    </dl><div class="ref-section section level2" id="section-value">
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value" aria-hidden="true"></a>Value</h2>

    <p>Returns new Luz metric.</p>
    </div>
    <div class="ref-section section level2" id="section-details">
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details" aria-hidden="true"></a>Details</h2>

    <p>In order to implement a new <code>luz_metric</code> we need to implement 3 methods:</p><ul><li><p><code>initialize</code>: defines the metric initial state. This function is
called for each epoch for both training and validation loops.</p></li>
<li><p><code>update</code>: updates the metric internal state. This function is called
at every training and validation step with the predictions obtained
by the model and the target values obtained from the dataloader.</p></li>
<li><p><code>compute</code>: uses the internal state to compute metric values. This
function is called whenever we need to obtain the current metric
value. Eg, it’s called every training step for metrics displayed in
the progress bar, but only called once per epoch to record it’s
value when the progress bar is not displayed.</p></li>
</ul><p>Optionally, you can implement a <code>abbrev</code> field that gives the metric an
abbreviation that will be used when displaying metric information in the
console or tracking record. If no <code>abbrev</code> is passed, the class name
will be used.</p>
<p>Let’s take a look at the implementation of <code>luz_metric_accuracy</code> so you
can see how to implement a new one:</p><div class="r"><pre class="sourceCode r"><code><span class="va">luz_metric_accuracy</span> <span class="op">&lt;-</span> <span class="fu">luz_metric</span><span class="op">(</span>
  <span class="co"># An abbreviation to be shown in progress bars, or </span>
  <span class="co"># when printing progress</span>
  abbrev <span class="op">=</span> <span class="st">"Acc"</span>, 
  <span class="co"># Initial setup for the metric. Metrics are initialized</span>
  <span class="co"># every epoch, for both training and validation</span>
  initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">self</span><span class="op">$</span><span class="va">correct</span> <span class="op">&lt;-</span> <span class="fl">0</span>
    <span class="va">self</span><span class="op">$</span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fl">0</span>
  <span class="op">}</span>,
  <span class="co"># Run at every training or validation step and updates</span>
  <span class="co"># the internal state. The update function takes `preds`</span>
  <span class="co"># and `target` as parameters.</span>
  update <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">preds</span>, <span class="va">target</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_argmax.html">torch_argmax</a></span><span class="op">(</span><span class="va">preds</span>, dim <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
    <span class="va">self</span><span class="op">$</span><span class="va">correct</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">correct</span> <span class="op">+</span> <span class="op">(</span><span class="va">pred</span> <span class="op">==</span> <span class="va">target</span><span class="op">)</span><span class="op">$</span>
      <span class="fu">to</span><span class="op">(</span>dtype <span class="op">=</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_dtype.html">torch_float</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span>
      <span class="fu">sum</span><span class="op">(</span><span class="op">)</span><span class="op">$</span>
      <span class="fu">item</span><span class="op">(</span><span class="op">)</span>
    <span class="va">self</span><span class="op">$</span><span class="va">total</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">total</span> <span class="op">+</span> <span class="va">pred</span><span class="op">$</span><span class="fu">numel</span><span class="op">(</span><span class="op">)</span>
  <span class="op">}</span>,
  <span class="co"># Use the internal state to query the metric value</span>
  compute <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">self</span><span class="op">$</span><span class="va">correct</span><span class="op">/</span><span class="va">self</span><span class="op">$</span><span class="va">total</span>
  <span class="op">}</span>
<span class="op">)</span>
</code></pre><p></p></div>
<p><strong>Note</strong>: It’s good practice that the <code>compute</code> metric returns regular R
values instead of torch tensors and other parts of luz will expect that.</p>
    </div>
    <div class="ref-section section level2" id="section-see-also">
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also" aria-hidden="true"></a>See also</h2>

    <div class="dont-index"><p>Other luz_metrics: 
<code><a href="luz_metric_accuracy.html">luz_metric_accuracy</a>()</code>,
<code><a href="luz_metric_binary_accuracy_with_logits.html">luz_metric_binary_accuracy_with_logits</a>()</code>,
<code><a href="luz_metric_binary_accuracy.html">luz_metric_binary_accuracy</a>()</code>,
<code><a href="luz_metric_binary_auroc.html">luz_metric_binary_auroc</a>()</code>,
<code><a href="luz_metric_mae.html">luz_metric_mae</a>()</code>,
<code><a href="luz_metric_mse.html">luz_metric_mse</a>()</code>,
<code><a href="luz_metric_multiclass_auroc.html">luz_metric_multiclass_auroc</a>()</code>,
<code><a href="luz_metric_rmse.html">luz_metric_rmse</a>()</code></p></div>
    </div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples" aria-hidden="true"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="va">luz_metric_accuracy</span> <span class="op">&lt;-</span> <span class="fu">luz_metric</span><span class="op">(</span></span>
<span class="r-in">  <span class="co"># An abbreviation to be shown in progress bars, or</span></span>
<span class="r-in">  <span class="co"># when printing progress</span></span>
<span class="r-in">  abbrev <span class="op">=</span> <span class="st">"Acc"</span>,</span>
<span class="r-in">  <span class="co"># Initial setup for the metric. Metrics are initialized</span></span>
<span class="r-in">  <span class="co"># every epoch, for both training and validation</span></span>
<span class="r-in">  initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">    <span class="va">self</span><span class="op">$</span><span class="va">correct</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span class="r-in">    <span class="va">self</span><span class="op">$</span><span class="va">total</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span class="r-in">  <span class="op">}</span>,</span>
<span class="r-in">  <span class="co"># Run at every training or validation step and updates</span></span>
<span class="r-in">  <span class="co"># the internal state. The update function takes `preds`</span></span>
<span class="r-in">  <span class="co"># and `target` as parameters.</span></span>
<span class="r-in">  update <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">preds</span>, <span class="va">target</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">    <span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_argmax.html">torch_argmax</a></span><span class="op">(</span><span class="va">preds</span>, dim <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span class="r-in">    <span class="va">self</span><span class="op">$</span><span class="va">correct</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">correct</span> <span class="op">+</span> <span class="op">(</span><span class="va">pred</span> <span class="op">==</span> <span class="va">target</span><span class="op">)</span><span class="op">$</span></span>
<span class="r-in">      <span class="fu">to</span><span class="op">(</span>dtype <span class="op">=</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_dtype.html">torch_float</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span></span>
<span class="r-in">      <span class="fu">sum</span><span class="op">(</span><span class="op">)</span><span class="op">$</span></span>
<span class="r-in">      <span class="fu">item</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in">    <span class="va">self</span><span class="op">$</span><span class="va">total</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">total</span> <span class="op">+</span> <span class="va">pred</span><span class="op">$</span><span class="fu">numel</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in">  <span class="op">}</span>,</span>
<span class="r-in">  <span class="co"># Use the internal state to query the metric value</span></span>
<span class="r-in">  compute <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">    <span class="va">self</span><span class="op">$</span><span class="va">correct</span><span class="op">/</span><span class="va">self</span><span class="op">$</span><span class="va">total</span></span>
<span class="r-in">  <span class="op">}</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="sticky-top">
    <nav id="toc"><h2 data-toc-skip>Contents</h2>

    </nav></div>
  </div>
</div>


      <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Daniel Falbel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.9000.9000.9000.</p>
</div>

      </footer></div>

  

  

  </body></html>

